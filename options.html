<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Salon Templates - Einstellungen</title>
  <link rel="stylesheet" href="admin-styles.css">
  <style>
    body { width: 100%; max-width: 800px; margin: 0 auto; }
    .container { max-height: none; }
    .header { text-align: left; }
    .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
    @media (max-width: 768px) { .settings-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üè• Salon Templates - Erweiterte Einstellungen</h1>
      <div class="version">Konfiguration f√ºr salonkee.at Integration</div>
    </div>

    <div style="padding: 30px;">
      <div class="settings-grid">
        <!-- ALLGEMEINE EINSTELLUNGEN -->
        <div class="section">
          <h3>üéõÔ∏è Allgemeine Einstellungen</h3>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="auto-focus">
              <span class="checkmark"></span>
              Erstes Feld automatisch fokussieren
            </label>
          </div>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="remember-last-template">
              <span class="checkmark"></span>
              Zuletzt verwendetes Template merken
            </label>
          </div>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="close-after-insert">
              <span class="checkmark"></span>
              Modal nach Einf√ºgen schlie√üen
            </label>
          </div>
          
          <div class="form-group">
            <label>Animation-Geschwindigkeit:</label>
            <select id="animation-speed">
              <option value="fast">Schnell</option>
              <option value="normal">Normal</option>
              <option value="slow">Langsam</option>
              <option value="none">Keine Animationen</option>
            </select>
          </div>
        </div>

        <!-- BUTTON KONFIGURATION -->
        <div class="section">
          <h3>üîò Button-Konfiguration</h3>
          
          <div class="form-group">
            <label>Button-Text:</label>
            <input type="text" id="button-text" placeholder="üìù Behandlungsvorlagen">
          </div>
          
          <div class="form-group">
            <label>Button-Position:</label>
            <select id="button-position">
              <option value="after">Nach Textarea</option>
              <option value="before">Vor Textarea</option>
              <option value="floating">Schwebend</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Button-Stil:</label>
            <select id="button-style">
              <option value="gradient">Gradient (Standard)</option>
              <option value="solid">Einfarbig</option>
              <option value="outline">Umrandet</option>
              <option value="minimal">Minimal</option>
            </select>
          </div>
        </div>

        <!-- TEMPLATE EINSTELLUNGEN -->
        <div class="section">
          <h3>üìù Template-Einstellungen</h3>
          
          <div class="form-group">
            <label>Standard-Datumsformat:</label>
            <select id="date-format-extended">
              <option value="de-DE">DD.MM.YYYY (Deutsch)</option>
              <option value="en-US">MM/DD/YYYY (US)</option>
              <option value="iso">YYYY-MM-DD (ISO)</option>
              <option value="custom">Benutzerdefiniert</option>
            </select>
          </div>
          
          <div class="form-group" id="custom-date-format" style="display: none;">
            <label>Benutzerdefiniertes Format:</label>
            <input type="text" id="custom-date-input" placeholder="DD.MM.YYYY HH:mm">
            <small style="color: #666; font-size: 11px;">
              DD=Tag, MM=Monat, YYYY=Jahr, HH=Stunde, mm=Minute
            </small>
          </div>
          
          <div class="form-group">
            <label>Template-Trenner:</label>
            <input type="text" id="template-separator" placeholder="===================================">
          </div>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="include-timestamp">
              <span class="checkmark"></span>
              Zeitstempel in Templates anzeigen
            </label>
          </div>
        </div>

        <!-- ERWEITERTE OPTIONEN -->
        <div class="section">
          <h3>‚öôÔ∏è Erweiterte Optionen</h3>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="debug-mode">
              <span class="checkmark"></span>
              Debug-Modus aktivieren
            </label>
          </div>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="backup-on-save">
              <span class="checkmark"></span>
              Automatisches Backup vor √Ñnderungen
            </label>
          </div>
          
          <div class="form-group">
            <label>Max. Backup-Anzahl:</label>
            <input type="number" id="max-backups" min="1" max="10" value="5">
          </div>
          
          <div class="form-group">
            <label>Tastenkombination (Shortcut):</label>
            <input type="text" id="keyboard-shortcut" placeholder="Ctrl+Shift+T" readonly>
            <button class="btn btn-outline" onclick="recordShortcut()">üìù Aufzeichnen</button>
          </div>
        </div>

        <!-- INTEGRATION -->
        <div class="section">
          <h3>üîó Integration</h3>
          
          <div class="form-group">
            <label>Ziel-Selektor:</label>
            <input type="text" id="target-selector" placeholder="#note_area">
            <small style="color: #666; font-size: 11px;">
              CSS-Selektor f√ºr das Notiz-Textfeld
            </small>
          </div>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="angular-compatibility">
              <span class="checkmark"></span>
              AngularJS-Kompatibilit√§t
            </label>
          </div>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="auto-inject">
              <span class="checkmark"></span>
              Button automatisch hinzuf√ºgen
            </label>
          </div>
          
          <div class="form-group">
            <label>Injection-Interval (ms):</label>
            <input type="number" id="inject-interval" min="1000" max="10000" value="5000">
          </div>
        </div>

        <!-- PERFORMANCE -->
        <div class="section">
          <h3>‚ö° Performance</h3>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="lazy-loading">
              <span class="checkmark"></span>
              Lazy Loading f√ºr Templates
            </label>
          </div>
          
          <div class="setting-item">
            <label class="checkbox-label">
              <input type="checkbox" id="cache-templates">
              <span class="checkmark"></span>
              Templates cachen
            </label>
          </div>
          
          <div class="form-group">
            <label>Cache-G√ºltigkeitsdauer (Minuten):</label>
            <input type="number" id="cache-duration" min="1" max="1440" value="60">
          </div>
        </div>
      </div>

      <!-- AKTIONEN -->
      <div class="section" style="margin-top: 40px;">
        <div class="form-actions">
          <button id="save-all-btn" class="btn btn-primary">üíæ Alle Einstellungen speichern</button>
          <button id="reset-settings-btn" class="btn btn-secondary">üîÑ Zur√ºcksetzen</button>
          <button id="export-settings-btn" class="btn btn-outline">üì§ Exportieren</button>
          <input type="file" id="import-settings-file" accept=".json" style="display: none;">
          <button id="import-settings-btn" class="btn btn-outline">üì• Importieren</button>
        </div>
      </div>

      <!-- STATUS -->
      <div class="section">
        <h3>üìä Status</h3>
        <div id="status-info" class="about">
          <p><strong>Extension Version:</strong> 2.0</p>
          <p><strong>Templates:</strong> <span id="template-count">0</span></p>
          <p><strong>Letzte √Ñnderung:</strong> <span id="last-modified">-</span></p>
          <p><strong>Storage-Nutzung:</strong> <span id="storage-usage">0 KB</span></p>
        </div>
      </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div id="toast-container"></div>
  </div>

  <script>
    // ERWEITERTE OPTIONEN LOGIK
    document.addEventListener('DOMContentLoaded', loadAllSettings);

    async function loadAllSettings() {
      try {
        const result = await chrome.storage.local.get();
        
        // Status aktualisieren
        document.getElementById('template-count').textContent = 
          Object.keys(result.customTemplates || {}).length;
        
        if (result.lastModified) {
          document.getElementById('last-modified').textContent = 
            new Date(result.lastModified).toLocaleString('de-DE');
        }
        
        // Storage-Gr√∂√üe berechnen
        const storageSize = new Blob([JSON.stringify(result)]).size;
        document.getElementById('storage-usage').textContent = 
          `${Math.round(storageSize / 1024)} KB`;
        
        // Einstellungen laden
        const settings = result.advancedSettings || {};
        Object.keys(settings).forEach(key => {
          const element = document.getElementById(key);
          if (element) {
            if (element.type === 'checkbox') {
              element.checked = settings[key];
            } else {
              element.value = settings[key];
            }
          }
        });
        
      } catch (error) {
        console.error('Fehler beim Laden der Einstellungen:', error);
      }
    }

    // Alle Einstellungen speichern
    document.getElementById('save-all-btn').onclick = async function() {
      const settings = {};
      
      // Alle Input-Felder sammeln
      document.querySelectorAll('input, select').forEach(element => {
        if (element.id && element.id !== 'import-settings-file') {
          if (element.type === 'checkbox') {
            settings[element.id] = element.checked;
          } else {
            settings[element.id] = element.value;
          }
        }
      });
      
      try {
        await chrome.storage.local.set({ 
          advancedSettings: settings,
          lastModified: Date.now()
        });
        showToast('Einstellungen gespeichert!', 'success');
        loadAllSettings(); // Status aktualisieren
      } catch (error) {
        showToast('Fehler beim Speichern', 'error');
      }
    };

    // Toast-Funktion
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      container.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>